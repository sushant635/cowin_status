{% extends "base.html" %}
{% load static %}
{% block page_name %} 
<h3 style="color:#035397">Dashboard</h3>
{% endblock page_name %}

{% block content_css %}
<style>
    .filter{
    width:200px !important;
  }
  .form-select{
  background-color:#f0f2fa !important;
  border: none !important;
  width:180px !important;
}
.upload-input{
  display: inline-block;
  background-color: indigo;
  color: white;
  padding: 0.5rem;
  /* font-family: sans-serif; */
  border-radius: 0.3rem;
  cursor: pointer;
  /* margin-top: 1rem; */
}
body{
  height: 100%;
  width:100%;
}
.topnav {
  overflow: hidden;
  /* background-image: linear-gradient(#68A000, #3E5622); */
  /* background-image: linear-gradient(180deg,#0575e6 20%, #021b78); */
  /* background: -webkit-gradient(linear, center top, center bottom, color-stop(0%,#0575e6), color-stop(20%,#0575e6), color-stop(40%,#021b78), color-stop(90%,#021b78), color-stop(100%,#021b78)); */
  background-color: #035397;
  border-top-right-radius: 10px;
  border-top-left-radius: 10px;
  width:100%;
  height: 65px;
}
.data{
  height: 100% !important;
  background-image: linear-gradient(#00bbff, #035397);
  /* display: flex; */
  max-height: 100%;
    flex-direction: column;
    justify-content: space-between;
}
.dataTables_length{
  display:none !important;
}
table>tbody>tr>td{
  padding-bottom: 20px !important;
  padding-top:10px !important;
}
.centerimg {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
.pagination1 {
  display: flex;
  list-style: none;
}
.pagination1 li {
  /* flex: 1; */
  margin: 0px 5px;
  padding:2px;
  padding-left: 25px;
  background: #dde1e7;
  border-radius: 50%;
  box-shadow: -3px -3px 7px #ffffff73, 3px 3px 5px rgba(94, 104, 121, 0.288);
}
.pagination1 li a {
  font-size: 18px;
  text-decoration: none;
  color: #4d3252;
  height: 35px;
  width: 35px!important;
  display: block;
  line-height: 45px;
}
/* .pagination li:first-child a {
  width: 120px;
}
.pagination li:last-child a {
  width: 100px;
} */
.pagination1 li.active {
  box-shadow: inset -3px -3px 7px #ffffff73,
    inset 3px 3px 5px rgba(4, 86, 228, 0.288);
    background:#035397;
    color:#ffffff;
}
/* .current{
  background:#035397;
} */
/* .pagination1 li.active  {
  font-size: 17px;
  color: #6f6cde;
} */
/* .pagination li:first-child {
  margin: 0 15px 0 0;
}
.pagination li:last-child {
  margin: 0 0 0 15px;
} */

/* #pagin {
  display: inline-block;
} */
/* #pagin li {
  display: inline-block;
} */
/* #pagin li {
  color: black;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
}
#pagin li.active {
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
}
#pagin li:hover:not(.active) {
  background-color: #ddd;
  border-radius: 5px;
} */
@media only screen and (max-width: 900px) {
        #myTable{
            display: none;
        }
        #site_csvsample{
          display: none; 
        }
        #upload_csv{
          display: none; 
        }
        .profile{
          display: none;
        }

    }
</style>
{% endblock content_css %}

{% block Department %} 
<select class='form-select' name="location" id="department1" >
  <option>Department</option>
  <option>Biz App</option>
  <option>Software Developer</option>
  {% for i in site%}
    <option value="{{i.id}}">{{i.name}}</option>
  {% endfor %}
</select>
{% endblock Department %}

{% block Branch %} 
<select class='form-select' name='branch' id='branch'>
  <option>Branch</option>
  <option>Mumbai Ho</option>
  <option>Bengaluru</option>
    {% for i in demp %}
    <option value='{{i.id}}'>{{i.name}}</option>
    {% endfor %}
</select>
{% endblock Branch %}
{% block Status %} 
<select class='form-select' id="status" name="status">
  <option>Status</option>
  <option>Fully Vaccinated</option>
  <option>Partially Vaccinated</option>
  <option>Not Vaccinated</option>
  <option>Not Checked</option>
   
</select>
{% endblock Status %}

{% block Gender %} 
<select class='form-select' id="gender" name="gender">
  <option>Gender</option>
  <option>Male</option>
  <option>Female</option>               
</select>
{% endblock Gender %}
          
            <div class="col-lg-2 col-md-3 col-sm-3 col-xs-8">
            
        </div>

{% block image_header %} 
<a href="{% url 'profile' %}" class="profile"><img src="/static/img/user (3).png" height='40px'></a>
{% endblock image_header %}
{% block content %}
<div class='row'>
    <div class='col-lg-9 col-md-9 col-sm-9 col-xs-12'>
        <div class='container mt-5'>
          <div class='container mt-5 justify-content-center'>
            <div class='row'>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-12 col-xl-2'>
                  <!-- <button>Data</button> -->
                  <a href="/static/sampletemplate/new_template.csv" download  class='btn btn-primary' style="color:black ;background-color:#ffffff;" id='site_csvsample'><img src="/static/img/download.png" height='20px'> Template</a>
              </div>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-4 col-xl-2'>
                  <form action="/dashboard/" method="POST" enctype="multipart/form-data" id='upload_csv'> 
                      {% csrf_token %}
                      <label for="upload" class='btn ' style="background-image: linear-gradient(#00bbff, #035397); color:#ffffff" ><img src="/static/img/plus.png" height='20px'> Upload File</label>                    
                      <input type="file" id="upload" name="upload" hidden/>
                  </form>
              </div>
              <div class='col-lg-3 col-sm-3 col-xs-3 col-xl-6'>
                <!-- <ul id="pagin" class="pagination1">
         
                </ul> -->
              </div>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-12 col-xl-2'>
                <button id="export" class='btn btn-primary ' style="height: 40px; background-image: linear-gradient(#00bbff, #035397);"><img src="/static/img/export.png" height='30px'></button>
              <!-- </div>
              <div class='col-lg-1'> -->
                <button id="exportemail" class='btn btn-primary' style="height: 40px; background-image: linear-gradient(#00bbff, #035397);"><img src="/static/img/send-mail.png" height='30px'></button>
              </div>
          </div>
          </div> 
        </div>
        <div class='container-fluid	'>
          <div class="container mt-5 justify-content-center">
            <div class="card ">
              <div style="overflow-x:auto;" class="table-responsive">
                <table class="table " id="myTable">
                  <thead style="background-color: #035397;" class='topnav'>
                    <tr class='text-light'>
                      <th scope="col" class='p-4'>Emp</th>
                      <th scope="col" class='p-4'>Last checked</th>
                      <th scope="col" class='p-4'>Branch</th>
                      <th scope="col" class='p-4'>Department</th>
                      <th scope="col" class='p-4'>Status</th>
                      <th scope="col" class='p-4' >Download Certificate</th>
                      <th scope="col" class='p-4'>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for emps in emp %}
                        <tr class='border-bottom' >
                          <td scope="row" class='p-4'>{{emps.name}}</td>
                          <td class='p-4'>{{emps.last_checked}}</td>
                          <td class='p-4'>{{emps.branch}}</td>
                          <td class='p-4'>{{emps.department}}</td>
                          <td  class='p-4'>{{emps.status}}</td>
                          <td class='p-4'><a class="use-address" download style="cursor: pointer;">Download Certificate</a></td>
                          {% if emps.status == 'Not Checked'%}
                          <td class='p-4'><button type="button" class="user-email btn btn-info">send email</button></td>
                          {% else %}
                          <td class='p-4'style="display:none"><button type="button" class="user-email btn btn-info">send email</button></td>
                          {% endif %}
                          <td class='p-4' style="display:none">{{emps.emp_code}}</td>
                          <td class='p-4' style="display:none">{{emps.gender}}</td>
                          <td style="display:none">{{emps.birth_year}}</td>
                          <td style="display:none">{{emps.beneficialy_id}}</td>
                          <td style="display:none">{{emps.vaccine}}</td>
                          <td style="display:none">{{emps.does1_date}}</td>
                          <td style="display:none">{{emps.does2_date}}</td>
                        </tr>
                      {% endfor %}
                  </tbody>
                </table>
              </div>
              
                <!-- <div class='topnav p-4'>
                    <div class='row'>
                        <div class='col-lg-2 col-md-2 col-sm-2 col-xs-2'>
                            <labe class='text-center text-light ms-4'>Emp</labe>
                        </div>
                        <div class='col-lg-1 col-md-1 col-sm-1'>
                            <labe class='text-center text-light '>Emp Code</labe>
                        </div>
                        <div class='col-lg-2 col-md-2 col-sm-2 ps-5'>
                            <labe class='text-center text-light '>Branch</labe>
                        </div>
                        <div class='col-lg-1 col-md-1 col-sm-1'>
                          <labe class='text-center text-light '>Gender</labe>
                        </div>
                        <div class='col-lg-2 col-md-2 col-sm-2 ps-5'>
                            <labe class='text-center text-light '>Department</labe>
                        </div>
                        <div class='col-lg-2 col-md-2 col-sm-2 ps-4'>
                          <labe class='text-center text-light '>Status</labe>
                        </div>
                        <div class='col-lg-2 col-md-2 col-sm-2'>
                          <labe class='text-center text-light '>Download Certificate</labe>
                        </div>
                    </div>
                </div> -->
                <!-- <div class='p-4 pt-2'>
                  <table id="myTable">
                    <tbody>
                      {% for emps in emp %}
                      <tr class='border-bottom' >
                        <td style="width: 13em !important" class='ms-4'>{{emps.name}}</td>
                        <td style="width: 8em !important ">{{emps.emp_code}}</td>
                        <td style="width: 11.73em !important ">{{emps.branch}}</td>
                        <td style="width: 8em !important ">{{emps.gender}}</td>
                        <td style="width: 11.60em !important ">{{emps.department}}</td>
                        <td  style="width: 12em !important ">{{emps.vaccination_status}}</td>
                        <td style="width: 12em !important ;cursor: pointer;"><a class="use-address" href='#'>Download Certificate</a></td>
                        <td style="display:none">{{emps.dose1_date}}</td>
                        <td style="display:none">{{emps.dose2_date}}</td>
                        <td style="display:none">{{emps.birth_year}}</td>
                        <td style="display:none">{{emps.beneficiary_reference_id}}</td>
                        <td style="display:none">{{emps.vaccine}}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div> -->
            </div>
      </div>
    </div>
    </div>
    <div class='col-lg-3 col-md-3 col-sm-3 col-xs-12'> 
      <div class='data'>
        <div id="container"  style="width: 100%;">
          <canvas id="pie-chart" class='centerimg pt-4' height='140px;'></canvas>
        </div>
        <!-- <img src="/media/cowin_status_pie.png" style="margin-top: 20px;">  -->
        <div class='row m-4'>
          <div class='card ' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <div class='col-lg-3'>
                <h1 style="color: #035397; font-weight:500px !important;">{{total}}</h1>
              </div>
              <div class='col-lg-4'>
                <h5 class="card-title">Total Employee</h5>
              </div>
            </div>
          </div>
        </div>
        <div class='row m-4 '>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'>
                <h1 style="color:lightgreen">{{fully_vaccinated}}</h1>
              </div>
              <div class='col-lg-5 col-md-5 col-sm-6 col-xl-4 col-xs-8'>
                <h5 class="card-title">Fully Vaccinated</h5>
              </div>
          </div>
        </div>
        </div>
        <div class='row m-4'>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'>
                <h1 style="color:orange">{{partial_vaccinated}}</h1>
              </div>
              <div class='col-lg-5 col-md-5 col-sm-6 col-xl-4 col-xs-8'>
                <h5 class="card-title">Partially Vaccinated</h5>
              </div>
          </div>
        </div>
        </div>
        <div class='row m-4'>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'>
                <h1 style="color: red;">{{not_vaccinated}}</h1>
              </div>
              <div class='col-lg-5 col-md-5 col-sm-6 col-xl-4 col-xs-8'>
                <h5 class="card-title">Not Vaccinated</h5>
              </div>
          </div>
        </div>
      </div>
      <div class='row m-4'>
        <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
          <div class='rows'>
            <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'>
              <h1 style="color:brown">{{not_checked}}</h1>
            </div>
            <div class='col-lg-5 col-md-5 col-sm-6 col-xl-4 col-xs-8'>
              <h5 class="card-title">Not Checked</h5>
            </div>
        </div>
      </div>
    </div>
    </div>
</div>

{% endblock content %}


{% block content_js %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
      {% for message in messages %}
      // window.onload = function(){
      //   alert('{{message}}') 
      //   alert('working') 

      // }
      alert('{{message}}')
      // alert(window.onload)
    {% endfor %}

    pageSize = 7
    var pageCount = $('#myTable tr').length/pageSize;
    for(var i = 0 ; i<pageCount;i++){
        
        $("#pagin").append('<li><a href="#">'+(i+1)+'</a></li> ');
      }

      $("#pagin li").first().find("a").addClass("current")
    showPage = function(page) {
	    $(".border-bottom").hide();
	    $(".border-bottom").each(function(n) {
	        if (n >= pageSize * (page - 1) && n < pageSize * page)
	            $(this).show();
	    });        
	}
    // alert(pageCount)
    // showPage(1);

$("#pagin li a").click(function() {
    $("#pagin li a").removeClass("current");
    $(this).addClass("current");
    showPage(parseInt($(this).text())) 
});

    // $(document).ready(function() {
    //             $('#myTable').paging({limit:7});
    //         });
    $("li").click(function () {
  $(this).addClass("active").siblings().removeClass("active");
});
      $('.user-email').click(function(){
        // alert('working')
        var name = $(this).closest("tr").find('td:eq(0)').text();
        var emp_code = $(this).closest("tr").find('td:eq(7)').text();
        $.ajax({
                  type : 'POST',
                  url :  "{% url 'send_email' %}",
                  data : {'name':name,'emp_code':emp_code},
                  success : function(response){
                  //reset the form after successful submit
                    alert(response) 
                  },
                  error : function(response){
                      console.log(response)
                  }
              });

      
      })

      $('#department1').click(function(){
        var input, filter , table , tr , td , i, txtvalue;
        input =  $('#department1').val();
        // alert(input)
        filter = input.toUpperCase();
        var branch = $('#branch').val().toUpperCase();
        var status = $('#status').val().toUpperCase();
        var gender = $('#gender').val().toUpperCase();
        // alert(branch)
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");
        // alert(tr.length)
        // alert(filter)
        for(i = 0 ; i< tr.length; i++){
          td = tr[i].getElementsByTagName("td")[3];
         var  td2 = tr[i].getElementsByTagName("td")[2]
        var   tdstatus = tr[i].getElementsByTagName("td")[4]
        var  tdgender = tr[i].getElementsByTagName("td")[8]
          if(td){
            txtvalue = td.textContent || td.innerText;
           var  txtvalue2 = td2.textContent || td2.innerText;
           var  txtvalue3 = tdstatus.textContent || tdstatus.innerText;
           var  txtvalue4 = tdgender.textContent || tdgender.innerText;
            console.log(txtvalue2)
            // alert(txtvalue.toUpperCase())
            // alert(filter)
            // alert(txtvalue)
            // console.log(txtvalue2.toUpperCase())
            if(txtvalue2.toUpperCase() == branch ){
              // alert(tr[i])
              console.log(tr[i])
              // alert('working')
            }
            // else{
            //   // alert('not working')
            //   cons
            // }
            
            if(branch == "BRANCH" && status == 'STATUS' && gender == 'GENDER' && filter != 'DEPARTMENT'){
                  if(txtvalue.toUpperCase().indexOf(filter) > -1){
                  tr[i].style.display = '';
                }else{
                  tr[i].style.display = 'none';
                }
            }
            else if(branch != "BRANCH" && status == 'STATUS' && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch){
                  console.log('working')
                tr[i].style.display = '';
                  }else{
                    tr[i].style.display = 'none';
                  }
            }else if(branch == "BRANCH" && status != 'STATUS' && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(branch == "BRANCH" && status == 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }

            }else if(branch != "BRANCH" && status != 'STATUS' && gender == 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch && txtvalue3.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(branch != "BRANCH" && status == 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(branch == "BRANCH" && status != 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(branch != "BRANCH" && status != 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == branch){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }
            else{
              console.log('Working')
            }

            // if(txtvalue.toUpperCase().indexOf(filter) > -1){
            //   tr[i].style.display = '';
            // }else{
            //   tr[i].style.display = 'none';
            // }

          }
        }
      })


      $('#branch').click(function(){
        var input , filter, table, tr, td,i,txtvalue;
        input = $('#branch').val();
        // alert(input)
        filter = input.toUpperCase();
        var department = $('#department1').val().toUpperCase();
        var status = $('#status').val().toUpperCase();
        var gender = $('#gender').val().toUpperCase();
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");
        
        for(i = 0 ; i< tr.length; i++){
          td = tr[i].getElementsByTagName("td")[2];
          var td2 = tr[i].getElementsByTagName("td")[3]
          var tdstatus = tr[i].getElementsByTagName("td")[4]
          var tdgender = tr[i].getElementsByTagName("td")[8]
          if(td){
            txtvalue = td.textContent || td.innerText;
            var txtvalue2 = td2.textContent || td2.innerText;
            var txtvalue3 = tdstatus.textContent || tdstatus.innerText;
            var txtvalue4 = tdgender.textContent || tdgender.innerText;

            if(filter != "BRANCH" && status == 'STATUS' && gender == 'GENDER' && department == 'DEPARTMENT'){
                  if(txtvalue.toUpperCase().indexOf(filter) > -1){
                  tr[i].style.display = '';
                }else{
                  tr[i].style.display = 'none';
                }
            }
            else if(department != 'DEPARTMENT' && status == 'STATUS' && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
                  console.log('working')
                tr[i].style.display = '';
                  }else{
                    tr[i].style.display = 'none';
                  }
            }else if(department == 'DEPARTMENT' && status != 'STATUS' && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && status == 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }

            }else if(department != 'DEPARTMENT' && status != 'STATUS' && gender == 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && status == 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && status != 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && status != 'STATUS' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == department){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }
            else{
              console.log('Working')
            }

          }
        }

      })

      $('#status').click(function(){
        var input, filter , table , tr , td,i,txtvalue;
        input = $('#status').val();
        filter = input.toUpperCase();
        // alert(filter)
        var department = $('#department1').val().toUpperCase();
        var gender = $('#gender').val().toUpperCase();
        var branch = $('#branch').val().toUpperCase();
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");
        // alert(tr.length)
        // alert(filter)
        for(i = 0 ; i< tr.length; i++){
          td = tr[i].getElementsByTagName("td")[4];
          var td2 = tr[i].getElementsByTagName("td")[3]
          var td3 = tr[i].getElementsByTagName("td")[2];
          var td4 = tr[i].getElementsByTagName("td")[8]

          if(td){
            txtvalue = td.textContent || td.innerText;
            var txtvalue2 = td2.textContent || td2.innerText;
            var txtvalue3 = td3.textContent || td3.innerText;
            var txtvalue4 = td4.textContent || td4.innerText;
            // alert(txtvalue.toUpperCase())
            // alert(filter)
            // alert(txtvalue)
            // if(txtvalue.toUpperCase() == filter ){
            //   tr[i].style.display = '';
            //   console.log(txtvalue)
            //   console.log(tr[i].innerText)
            // }else{BRANCH
            //   tr[i].style.display = 'none';
            // }
            if(filter != "STATUS" && branch == 'BRANCH' && gender == 'GENDER' && department == 'DEPARTMENT'){
                  if(txtvalue.toUpperCase().indexOf(filter) > -1){
                  tr[i].style.display = '';
                }else{
                  tr[i].style.display = 'none';
                }
            }
            else if(department != 'DEPARTMENT' && branch == 'BRANCH' && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
                  console.log('working')
                tr[i].style.display = '';
                  }else{
                    tr[i].style.display = 'none';
                  }
            }else if(department == 'DEPARTMENT' && branch != 'BRANCH'  && gender == 'GENDER'){
                if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && branch == 'BRANCH' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }

            }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && gender == 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == branch){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && branch == 'BRANCH' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && branch != 'BRANCH' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == gender){
                    console.log('working')
                  tr[i].style.display = '';
                   }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && gender != 'GENDER'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == department){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }
            else{
              console.log('Working')
            }


          }
        }
      
      })

      $('#gender').click(function(){
        var input, filter , table , tr , td,i,txtvalue;
        input = $('#gender').val();
        filter = input.toUpperCase();
        table = document.getElementById("myTable");
        tr = table.getElementsByTagName("tr");
        var department = $('#department1').val().toUpperCase();
        var status = $('#status').val().toUpperCase();
        var branch = $('#branch').val().toUpperCase();
        // alert(tr)
        // alert(tr.length)
        // alert(filter)
       for(i = 0 ; i< tr.length; i++){
        console.log(tr[i])
          td = tr[i].getElementsByTagName("td")[8];
          var td4 = tr[i].getElementsByTagName("td")[4];
          var td2 = tr[i].getElementsByTagName("td")[3]
          var td3 = tr[i].getElementsByTagName("td")[2];
          if(td){
            txtvalue = td.textContent || td.innerText;
            var txtvalue2 = td2.textContent || td2.innerText;
            var txtvalue3 = td3.textContent || td3.innerText;
            var txtvalue4 = td4.textContent || td4.innerText;
            // alert(txtvalue.toUpperCase())
            // alert(filter)
            // alert(txtvalue)
            // if(txtvalue.toUpperCase() == filter ){
            //   tr[i].style.display = '';
            //   console.log(txtvalue)
            //   console.log(tr[i].innerText)
            // }else{
            //   tr[i].style.display = 'none';GENDER
            // }
            if(filter != "GENDER" && branch == 'BRANCH' && status == 'STATUS' && department == 'DEPARTMENT'){
                  if(txtvalue.toUpperCase().indexOf(filter) > -1){
                  tr[i].style.display = '';
                }else{
                  tr[i].style.display = 'none';
                }
            }
            else if(department != 'DEPARTMENT' && branch == 'BRANCH' && status == 'STATUS'){
                if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
                  console.log('working')
                tr[i].style.display = '';
                  }else{
                    tr[i].style.display = 'none';
                  }
            }else if(department == 'DEPARTMENT' && branch != 'BRANCH'  && status == 'STATUS'){
                if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && branch == 'BRANCH' && status != 'STATUS'){
              if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }

            }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && status == 'STATUS'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == branch){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && branch == 'BRANCH' && status != 'STATUS'){
              if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department == 'DEPARTMENT' && branch != 'BRANCH' && status != 'STATUS'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == status){
                    console.log('working')
                  tr[i].style.display = '';
                   }else{
                      tr[i].style.display = 'none';
                    }
            }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && status != 'STATUS'){
              if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == status && txtvalue2.toUpperCase() == department){
                    console.log('working')
                  tr[i].style.display = '';
                    }else{
                      tr[i].style.display = 'none';
                    }
            }
            else{
              console.log('Working')
            }
          }
        }
      
      })
      function export2csv() {
        let data = "";
        const tableData = [];
        const rows = document.querySelectorAll("table tr");
        for (const row of rows) {
          const rowData = [];
          for (const [index, column] of row.querySelectorAll("th, td").entries()) {
            // To retain the commas in the "Description" column, we can enclose those fields in quotation marks.
            if ((index + 1) % 3 === 0) {
              rowData.push('"' + column.innerText + '"');
            } else {
              rowData.push(column.innerText);
            }
          }
          tableData.push(rowData.join(","));
        }
        data += tableData.join("\n");
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([data], { type: "text/csv" }));
        a.setAttribute("download", "data.csv");
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      function parseDate(str) {
      var mdy = str.split('-');
      // alert(mdy)
      // alert(new Date(mdy[2], mdy[0]-1, mdy[1]))
      return new Date(mdy[2], mdy[0]-1, mdy[1]);  
      }

      function datediff(first, second) {
          // Take the difference between the dates and divide by milliseconds per day.
          // Round to nearest whole number to deal with DST.
          return Math.round((second-first)/(1000*60*60*24));
      }

      $('#export').click(function(){
        var arrData=[];
   // loop over each table row (tr)
          $("#myTable tr").each(function(){
                var currentRow=$(this);
                if(currentRow.is(':hidden')){
                 console.log('working')
                }else{
                    // console.log(currentRow.length)
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();

                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  console.log(Difference_In_Time / (1000 * 60 * 60 * 24))
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  // alert(row.length)
                  // ['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'],
                  arrData.push(row.join(","))
                  console.log('rows',row)
                  // alert(arrData.length)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  // alert(arrData)
                  // console.log('array data',arrData);
                  // );
                  // 
                }   
                // 
          });   
          // alert(arrData.length) 
          len = arrData.length;
          console.log(len)
          var data = []
          data.push(['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'])
          for(var i =1 ; i<=len;i++){
            console.log(i)
            console.log(arrData[i])
            data.push(arrData[i])
          }
          console.log(data)
          downloadCSVFile(data.join("\n"), "status.csv")
          // htmlToCSV(arrData, "status.csv");
        })



      function htmlToCSV(html, filename) {
        var data = [];
        var rows = document.querySelectorAll("table tr");
        console.log(rows.length)
        for (var i = 0; i < rows.length; i++) {
          var row = [], cols = rows[i].querySelectorAll("td, th");            
          for (var j = 0; j < cols.length; j++) {
                  row.push(cols[j].innerText);
                      }
          // console.log(row.join(","))
          data.push(row.join(",")); 
          // console.log('NEXT LINE',data.join("\n"))		
        }

        // downloadCSVFile(data.join("\n"), );
      }

      function downloadCSVFile(csv, filename) {
        var csv_file, download_link;

        csv_file = new Blob([csv], {type: "text/csv"});

        download_link = document.createElement("a");

        download_link.download = filename;

        download_link.href = window.URL.createObjectURL(csv_file);

        download_link.style.display = "none";

        document.body.appendChild(download_link);

        download_link.click();
      }

      $('#exportemail').click(function(){
        var arrData=[];
        $("#myTable tr").each(function(){
                var currentRow=$(this);
                if(currentRow.is(':hidden')){
                 console.log('working')
                }else{
                    // console.log(currentRow.length)
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();


                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  arrData.push(row.join(","))
                  console.log('rows',row)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  console.log('array data',arrData);
                  // htmlToCSV(arrData, "status.csv");
                }    
          }); 
          $.ajax({
            type : 'POST',
            url :  "{% url 'exportfile' %}",
            data : {'data':arrData},
            success : function(response){
            //reset the form after successful submit
              alert(response) 
            },
            error : function(response){
                console.log(response)
            }
        });

      })

        $('#upload').change(function(){
            $('#upload_csv').submit();
            })
            // $(function() {
            //   $("#table_id").dataTable();
            // });


            var config = {
              type: 'doughnut',
                data: {
                // labels:['Fully Vaccinated','Partial vaccinated','Not Vaccinated','Not Checked']
                  datasets: [{
                    data: [{{fully_vaccinated}}, {{partial_vaccinated}}, {{not_vaccinated}},{{not_checked}}],
                    backgroundColor: [
                      '#00ff00','#ffa500','#ff0000','#A52A2A'
                    ],
          //           label: 'Population'
                  }],
                  labels: ['Fully Vaccinated','Partial vaccinated','Not Vaccinated','Not Checked']
                },
                options: {
                  responsive: true,
                  legend: {
                    display: false
                },
                tooltips: {
                    enabled: true,
                }

                }
              };
           
              window.onload = function() {
                var ctx = document.getElementById('pie-chart').getContext('2d');
                window.myPie = new Chart(ctx, config);
              };
          $('.use-address').click(function () {
            // alert('working')
            var name = $(this).closest("tr").find('td:eq(0)').text();
            var emp_code = $(this).closest("tr").find('td:eq(7)').text();              
            // alert(id);
              $.ajax({
                  type : 'POST',
                  url :  "{% url 'download_certificate' %}",
                  data : {'name':name,'emp_code':emp_code},
                  success : function(response){
                  //reset the form after successful submit
                    // alert(response)
                    if(response != 'File data not present in database'){
                      var url = response
                    // window.location = url; 
                    window.open(url, '_blank').focus();
                    }else{
                      alert(response)
                    }
                    
                  },
                  error : function(response){
                      console.log(response)
                  }
              });
          });
    </script> 
{% endblock content_js %}
