{% extends "base.html" %}
{% load static %}


{% block content_css %}
<style>
    .filter{
    width:200px !important;
  }
  .form-select{
  background-color:#f0f2fa !important;
  border-color: #035397;
  width:100% !important;

}
.upload-input{
  display: inline-block;
  background-color: indigo;
  color: white;
  padding: 0.5rem;
  /* font-family: sans-serif; */
  border-radius: 0.3rem;
  cursor: pointer;
  /* margin-top: 1rem; */
}
body{
  height: 100%;
  width:100%;
}
.topnav {
  overflow: hidden;
  /* background-image: linear-gradient(#68A000, #3E5622); */
  /* background-image: linear-gradient(180deg,#0575e6 20%, #021b78); */
  /* background: -webkit-gradient(linear, center top, center bottom, color-stop(0%,#0575e6), color-stop(20%,#0575e6), color-stop(40%,#021b78), color-stop(90%,#021b78), color-stop(100%,#021b78)); */
  background-color: #035397;
  border-top-right-radius: 10px;
  border-top-left-radius: 10px;
  width:100%;
  height: 65px;
}
.data{
  height: 100% !important;
  background-image: linear-gradient(#00bbff, #035397);
  /* display: flex; */
  max-height: 100%;
    flex-direction: column;
    justify-content: space-between;
}
.dataTables_length{
  display:none !important;
}
table>tbody>tr>td{
  padding-bottom: 20px !important;
  padding-top:10px !important;
}
.centerimg {
  display: block;
  margin-left: auto;
  margin-right: auto;
  width: 50%;
}
.pagination1 {
  display: flex;
  list-style: none;
}
.pagination1 li {
  /* flex: 1; */
  margin: 0px 5px;
  padding:2px;
  padding-left: 25px;
  background: #dde1e7;
  border-radius: 50%;
  box-shadow: -3px -3px 7px #ffffff73, 3px 3px 5px rgba(94, 104, 121, 0.288);
}
.pagination1 li a {
  font-size: 18px;
  text-decoration: none;
  color: #4d3252;
  height: 35px;
  width: 35px!important;
  display: block;
  line-height: 45px;
}
/* .pagination li:first-child a {
  width: 120px;
}
.pagination li:last-child a {
  width: 100px;
} */
.pagination1 li.active {
  box-shadow: inset -3px -3px 7px #ffffff73,
    inset 3px 3px 5px rgba(4, 86, 228, 0.288);
    background:#035397;
    color:#ffffff;
}
.tooltip {
  position: relative;
  display: inline-block;
  border-bottom: 1px dotted black;
}

.tooltip .tooltiptext {
  visibility: hidden;
  width: 120px;
  background-color: black;
  color: #fff;
  text-align: center;
  border-radius: 6px;
  padding: 5px 0;
  
  /* Position the tooltip */
  position: absolute;
  z-index: 1;
  bottom: 100%;
  left: 50%;
  margin-left: -60px;
}

.tooltip:hover .tooltiptext {
  visibility: visible;
}
/* .current{
  background:#035397;
} */
/* .pagination1 li.active  {
  font-size: 17px;
  color: #6f6cde;
} */
/* .pagination li:first-child {
  margin: 0 15px 0 0;
}
.pagination li:last-child {
  margin: 0 0 0 15px;
} */

/* #pagin {
  display: inline-block;
} */
/* #pagin li {
  display: inline-block;
} */
/* #pagin li {
  color: black;
  float: left;
  padding: 8px 16px;
  text-decoration: none;
}
#pagin li.active {
  background-color: #4CAF50;
  color: white;
  border-radius: 5px;
}
#pagin li:hover:not(.active) {
  background-color: #ddd;
  border-radius: 5px;
} */
div.pager {
    /* text-align: center; */
    margin: 1em 0;
}

div.pager li {
    display: inline-block;
    width: 2.0em;
    height: 2.0em;
    line-height: 2.0;
    text-align: center;
    cursor: pointer;
    background: #ffffff;
    /* color: #000; */
    margin-right: 0.8em;
    margin-top:0% !important;
    border-radius: 50%;
}
li a {
  text-decoration: none;
  color: black; 
}
#previous-page{
  width: 2.8em !important;
  background: #f0f2fa !important;
  color: #707070  !important;
  border-radius: 1px !important;
  /* display: inline-block; */
  /* position: fixed; */

}
#next-page{
  width: 2.8em !important;
  background: #f0f2fa !important;
  /* color: #035397  !important; */
  color: #707070  !important;
  border-radius: 1px !important;status_tr
  

}
div.pager li.active{
  background-color:#035397;
  color: #ffffff;
}

/* div.pager li.active, a.active {
    background-color: #035397;
    color:#f0f2fa !important;
} */
@media screen and (max-width:1024px)  {
  table{
    width:100% !important;
    height:100%  !important;
  }
    .form-select{
    background-color:#f0f2fa !important;
    border: none !important;
    width:100% !important;
  }
  #exportfile{
    height:40px !important;
  }
  .col-lg-9{
    width:70% !important;
  }
  /* table>tbody>tr>td{
  padding-bottom: 0px !important;
  padding-top:0px !important;
} */
/* table>tr{
  width:100% !important;
} */
.col-lg-3{
  width:30% !important;
}
.col-lg-4{
  width:40%  !important;
}
.status_tr{
  width:100px  !important;
}
.h5, h5{
  font-size: 1.00rem !important;
}
/* .centerimg{
  height:100px !important;
} */



}
@media screen and (max-width: 900px) {
  .form-select{
  background-color:#f0f2fa !important;
  border: none !important;
  width:100% !important;
}
      #myTable{
            display: none;
        }
        #site_csvsample{
          display: none; 
        }
        #upload_csv{
          display: none; 
        }
        .profile{
          display: none;
        }
        .dashboard1{
          display: none;
        }
        #pages{
          display: none;
        }
        .profile2{
          display: none;
        }
        .col-md-12 {
          width: 70%  !important;
          /* text-align: center  !important; */
          margin-left: 120px  !important;

        }
        .exporticon{
          text-align: center;
        }

}

@media screen and (max-width: 600px) {
        #myTable{
            display: none;
        }
        #site_csvsample{
          display: none; 
        }
        #upload_csv{
          display: none; 
        }
        .profile{
          display: none;
        }
        .dashboard1{
          display: none;
        }
        #pages{
          display: none;
        }
        /* .exporticon{
          text-align: center;
        } */
        .profile2{
          display: none;
        }
        .datag{
          width:17% !important;
        }
        .firstbutton{
          margin-left: 30% !important;
        }
        .data{
          width:100% !important;
          height:100% !important;
        }
        .col-xs-12{
          width:100% !important;
        }
        .secondtbutton{
          /* padding-left: 10px !important; */
        }
        .col-md-12 {
          /* text-align: center  !important; */
          margin-left: 0%  !important;

        }
      }
      /* @media screen and (max-width: 350 px){
        .secondbutton{
          padding-left: 60px !important;
        }
      }
   */
</style>
{% endblock content_css %}
{% block page_name %} 
<h3 style="color:#035397" class="dashboard1">Dashboard</h3>
{% endblock page_name %}
{% block dashboard %} 
<a class="nav-link " aria-current="page" href="{% url 'dashboard' %}">Dashboard</a>
{% endblock dashboard %}
{% block profile %} 
<a class="nav-link " aria-current="page" href="{% url 'profile' %}">Profile</a>
{% endblock profile %}

<!--  -->
{% block Department %}
<form method="get" action="{% url 'dashboard'%}" id='filter_form'>
<select class='form-select select' name="department" id="department1" >
  {% if department1 != None%}
  {% if department1 == 'Department' %}
  <option value="Department">Department</option>
  {% else %}
  <option >{{department1}}</option>
  <option value="Department">Department</option>
  {% endif %}
  {% for i in department%}
  <option value="{{i}}">{{i}}</option>
  {% endfor %}
  {% else %}
  <option value="Department">Department</option>
  {% for i in department%}
  <option value="{{i}}">{{i}}</option>
  {% endfor %}
  {% endif %}
</select>
<!-- <input type="submit" value='submit'>  -->

{% endblock Department %}

{% block Branch %} 
<select class='form-select' name='branch' id='branch'>
  {% if branch1 != None%}
  {% if branch1 == 'Branch' %}
  <option value="Branch">Branch</option>
  {% else %}
  <option >{{branch1}}</option>
  <option value="Branch">Branch</option>
  {% endif %}
    {% for i in branch %}
    <option value='{{i}}'>{{i}}</option>
    {% endfor %}
  {% else %}
  <option value="Branch">Branch</option>
    {% for i in branch %}
    <option value='{{i}}'>{{i}}</option>
    {% endfor %}
  {% endif %}
</select>
{% endblock Branch %}
{% block Status %} 
<select class='form-select' id="status" name="status">
  {% if status1 != None%}
  {% if status1 == 'Status' %}
  <option>Status</option>
  {% else %}
  <option >{{status1}}</option>
  <option>Status</option>
  {% endif %}
  <option>Fully Vaccinated</option>
  <option>Partially Vaccinated</option>
  <option>Not Vaccinated</option>
  <option>Not Checked</option>
  {% else %}
  <option>Status</option>
  <option>Fully Vaccinated</option>
  <option>Partially Vaccinated</option>
  <option>Not Vaccinated</option>
  <option>Not Checked</option>
   {% endif %}
</select>
{% endblock Status %}

{% block Gender %} 
<select class='form-select' id="gender" name="gender">
  {% if gender1 != None%}
  {% if gender1 == 'Gender' %}
  <option>Gender</option>
  {% else %}
  <option >{{gender1}}</option>
  <option>Gender</option>
  {% endif %}
  <option>Male</option>
  <option>Female</option>
  {% else %}
    <option>Gender</option>
    <option>Male</option>
    <option>Female</option> 
  {% endif %}              
</select>
</form>
{% endblock Gender %}
{% block submit_button %} 
<button class="btn " type="submit" id='submit' style="background-image: linear-gradient(#00bbff, #035397); color:#f0f2fa">Search</button>

{% endblock submit_button %}
</form>
          
            <!-- <div class="col-lg-2 col-md-3 col-sm-3 col-xs-8">
            
        </div> -->

{% block image_header %} 
<a href="{% url 'profile' %}" class="profile2" data-toggle="tooltip" data-placement="top" title="Admin Profile"><img src="/static/img/user (3).png" height='40px'></a>
{% endblock image_header %}
{% block content %}
<!-- <form method="get"> -->
  {{ filtered_qs.form}}
<!-- </form> -->

<div class='row'>
    <div class='col-lg-9 col-md-9 col-sm-9 col-xs-12 col-xl-9'>
        <div class='container mt-5'>
          <div class='container mt-5 justify-content-center'>
            <div class='row'>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-12 col-xl-2 mt-2'>
                  <!-- <button>Data</button> -->
                  <a href="/static/sampletemplate/new_template.csv" download  class='btn btn-primary' style="color:black ;background-color:#ffffff;" id='site_csvsample'><img src="/static/img/download.png" height='20px'> Template</a>
              </div>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-4 col-xl-2 mt-2'>
                  <form action="/dashboard/" method="POST" enctype="multipart/form-data" id='upload_csv'> 
                      {% csrf_token %}
                      <label for="upload" class='btn ' style="background-image: linear-gradient(#00bbff, #035397); color:#ffffff" ><img src="/static/img/plus.png" height='20px'> Upload File</label>                    
                      <input type="file" id="upload" name="upload" hidden/>
                  </form>
              </div>
              <div class='col-lg-4 col-sm-1 col-md-6 col-xs-3 col-xl-6' id="pages">
                <div class="pager">
                    
                </div>
                
                <!-- <ul id="pagin" class="pagination1">
                  
                </ul> --> 
            </div>
              <div class='col-lg-3 col-md-4 col-sm-3 col-xs-12 col-xl-2 mt-2' >
                <div class='row exporticon'>
                  <div class='col-xl-3 col-lg-3 col-md-5 col-sm-6 col-xs-4 datag firstbutton' >
                    <form method="POST" action="{% url 'exportfiledata'%}" id="export_form" >
                      {% csrf_token %}
                      <button id="exportfile" class='btn btn-primary ' style="height: 40px; background-image: linear-gradient(#00bbff, #035397);" data-toggle="tooltip" data-placement="top" title="Export CSV File" type='button'><img src="/static/img/export.png" height='24px'></button>
                    </form>
                  </div>
                  <div class='col-xl-3 col-lg-3 col-md-5 col-sm-6 col-xs-4 datag secondbutton'>
                    <form method="POST" action="{% url 'exportfile'%}" id="exportemail_form" >
                      <button id="exportemailfile" class='btn btn-primary' style="height: 40px; background-image: linear-gradient(#00bbff, #035397);" data-toggle="tooltip" data-placement="top" title="Export CSV for Email" type='button'><img src="/static/img/send-mail.png" height='24px'></button>
                    </form>
                  </div>
                </div>
              </div>
          </div>
          </div> 
        </div>
        <div class='container-fluid	'>
          <div class="container mt-5 justify-content-center">
            <div class="card ">
              <div  class="table-responsive">
                <table class="table paginated" id="myTable">
                  <thead style="background-image: linear-gradient(#00bbff, #035397);border-radius: 25px !important" class='topnav'>
                    <tr class='text-light'>
                      <th scope="col" class='p-4' id="employee_id" style="cursor: pointer;">Employee Name</th>
                      <th scope="col" class='p-4'>Last checked</th>
                      <th scope="col" class='p-4'>Branch</th>
                      <th scope="col" class='p-4'>Department</th>
                      <th scope="col" class='p-4' id="status_id" style="cursor: pointer;">Status</th>
                      <th scope="col" class='p-4' >Download Certificate</th>
                      <th scope="col" class='p-4'>Action</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for emps in emp %}
                        <tr class='border-bottom' >
                          <td scope="row" class='p-4'>{{emps.name}}</td>
                          <td class='p-4'>{{emps.last_checked}}</td>
                          <td class='p-4'>{{emps.branch}}</td>
                          <td class='p-4'>{{emps.department}}</td>
                          {% if emps.status == "Not Checked" %}
			                      <td  class='p-4 status_tr' ><b style="padding:10px;background-color:#ffebeb;border-radius: 20px;"><span style="color: #fd3636;">{{emps.status}}</span></b></td>                                
                          {% elif emps.status == 'Partially Vaccinated' %}
                          <td  class='p-4 status_tr' style="color:#ffb800" ><b  style="padding:10px;;background-color:#fff8e5;border-radius: 20px;" >{{emps.status}}</b></td>                                
                          {% elif emps.status == 'Fully Vaccinated' %}
                          <td  class='p-4 status_tr' style="color:#20e074" ><b style="padding:10px;;background-color:#e6fdf4;border-radius: 20px;" >{{emps.status}}</b></td>                                
                          {% else %}
                          <td  class='p-4 status_tr' style="color:#7d3ac1;" ><b style="padding:10px;;background-color:#dbd5e2;border-radius: 20px;" >{{emps.status}}</b></td>                                
                          {% endif %} 
                          <td class='p-4'><a class="use-address" download style="cursor: pointer;">Download Certificate</a></td>
                          {% if emps.status == 'Not Checked'%}
                          <td class='p-4'><button type="button" class="user-email btn" style="background-image: linear-gradient(#00bbff, #035397);color:#f0f2fa"><img src="/static/img/send-mail.png" height='24px'></button></td>
                          {% else %}
                          <td class='p-4'style="display:none"><button type="button" class="user-email btn btn-info"><img src="/static/img/send-mail.png" height='24px'></button></td>
                          {% endif %}
                          <td class='p-4' style="display:none">{{emps.emp_code}}</td>
                          <td class='p-4' style="display:none">{{emps.gender}}</td>
                          <td style="display:none">{{emps.birth_year}}</td>
                          <td style="display:none">{{emps.beneficialy_id}}</td>
                          <td style="display:none">{{emps.vaccine}}</td>
                          <td style="display:none">{{emps.does1_date}}</td>
                          <td style="display:none">{{emps.does2_date}}</td>
                        </tr>
                      {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
      </div>
    </div>
    </div>
    <div class='col-lg-3 col-md-12 col-sm-3 col-xs-12 col-xl-3'> 
      <div class='data'>
        <div id="container"  style="width: 100%;">
          <canvas id="pie-chart" class='centerimg pt-4' height='140px;'></canvas>
        </div>
        <!-- <img src="/media/cowin_status_pie.png" style="margin-top: 20px;">  -->
        <div class='row m-4'>
          <div class='card ' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <!-- <div class='col-lg-3 col-xs-6 col-sm-4 col-md-4 col-xl-2'> -->
                <h1 style="color: #000; font-weight:500px !important;">{{total}}</h1>
              <!-- </div> -->
              <!-- <div class='col-lg-5 col-xl-6 col-xs-6 col-sm-8 col-md-8'> -->
                <h5 class="card-title">Total Employee</h5>
              <!-- </div> -->
            </div>
          </div>
        </div>
        <div class='row m-4 '>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <!-- <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'> -->
                <h1 style="color:#20e074">{{fully_vaccinated}}</h1>
              <!-- </div> -->
              <!-- <div class='col-lg-5 col-md-5 col-sm-6 col-xl-6 col-xs-8'> -->
                <h5 class="card-title">Fully Vaccinated</h5>
              <!-- </div> -->
          </div>
        </div>
        </div>
        <div class='row m-4'>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <!-- <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'> -->
                <h1 style="color:#ffb800">{{partial_vaccinated}}</h1>
              <!-- </div> -->
              <!-- <div class='col-lg-5 col-md-5 col-sm-6 col-xl-6 col-xs-8'> -->
                <h5 class="card-title">Partially Vaccinated</h5>
              <!-- </div> -->
          </div>
        </div>
        </div>
        <div class='row m-4'>
          <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
            <div class='rows'>
              <!-- <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'> -->
                <h1 style="color: #7d3ac1">{{not_vaccinated}}</h1>
              <!-- </div> -->
              <!-- <div class='col-lg-5 col-md-5 col-sm-6 col-xl-6 col-xs-8'> -->
                <h5 class="card-title">Not Vaccinated</h5>
              <!-- </div> -->
          </div>
        </div>
      </div>
      <div class='row m-4'>
        <div class='card' style="box-shadow: 5px 6px 6px 2px #035397;border-radius: 10px;">
          <div class='rows'>
            <!-- <div class='col-lg-3 col-md-4 col-sm-4 col-xl-3 col-xs-4'> -->
              <h1 style="color:#fd3636">{{not_checked}}</h1>
            <!-- </div> -->
            <!-- <div class='col-lg-5 col-md-5 col-sm-6 col-xl-6 col-xs-8'> -->
              <h5 class="card-title">Not Checked</h5>
            <!-- </div> -->
        </div>
      </div>
    </div>
    </div>
</div>

{% endblock content %}


{% block content_js %}

<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
  
$('#exportemailfile').click(function(){
  var department1 = $('#department1').val()
  // alert(department1)
  var branch = $('#branch').val();
  var status = $('#status').val();
  var gender = $('#gender').val();
  var department_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "department1").val(department1)
  var branch_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "branch").val(branch)
  var status_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "status").val(status)

  var gender_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "gender").val(gender)
  $('#exportemail_form').append(department_input,branch_input,status_input,gender_input)

  
  $('#exportemail_form').submit()
  
  console.log(branch,status,gender,department1)
})



$('#exportfile').click(function(){
  // alert('working')
  var department1 = $('#department1').val()
  // alert(department1)
  var branch = $('#branch').val();
  var status = $('#status').val();
  var gender = $('#gender').val();
  var department_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "department1").val(department1)
  var branch_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "branch").val(branch)
  var status_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "status").val(status)

  var gender_input = $("<input>")
               .attr("type", "hidden")
               .attr("name", "gender").val(gender)
  $('#export_form').append(department_input,branch_input,status_input,gender_input)

  
  $('#export_form').submit()
  
  console.log(branch,status,gender,department1)
})



  console.log(screen.height,screen.width)
      {% for message in messages %}
      // window.onload = function(){
      //   alert('{{message}}') 
      //   alert('working') 

      // }
      alert('{{message}}')
      // alert(window.onload)
    {% endfor %}

$('#status_id').click(function(){
  // alert('working')\
  var table, rows, switching, i, x, y, shouldSwitch;
  table = document.getElementById("myTable");
  switching = true;
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {
    //start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      x = rows[i].getElementsByTagName("TD")[4];
      y = rows[i + 1].getElementsByTagName("TD")[4];
      //check if the two rows should switch place:
      if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
        //if so, mark as a switch and break the loop:
        shouldSwitch = true;
        break;
      }
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
    }
  }
})


$('#employee_id').click(function(){
  var table, rows, switching, i, x, y, shouldSwitch;
  table = document.getElementById("myTable");
  switching = true;
  /*Make a loop that will continue until
  no switching has been done:*/
  while (switching) {
    //start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /*Loop through all table rows (except the
    first, which contains table headers):*/
    for (i = 1; i < (rows.length - 1); i++) {
      //start by saying there should be no switching:
      shouldSwitch = false;
      /*Get the two elements you want to compare,
      one from current row and one from the next:*/
      x = rows[i].getElementsByTagName("TD")[0];
      y = rows[i + 1].getElementsByTagName("TD")[0];
      //check if the two rows should switch place:
      if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
        //if so, mark as a switch and break the loop:
        shouldSwitch = true;
        break;
      }
    }
    if (shouldSwitch) {
      /*If a switch has been marked, make the switch
      and mark that a switch has been done:*/
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
    }
  }



})

  //   pageSize = 7
  //   var pageCount = $('#myTable tr').length/pageSize;
  //   for(var i = 0 ; i<pageCount;i++){
        
  //       $("#pagin").append('<li><a href="#">'+(i+1)+'</a></li> ');
  //     }

  //     $("#pagin li").first().find("a").addClass("current")
  //   showPage = function(page) {
	//     $(".border-bottom").hide();
	//     $(".border-bottom").each(function(n) {
	//         if (n >= pageSize * (page - 1) && n < pageSize * page)
	//             $(this).show();
	//     });        
	// }
    // alert(pageCount)
    // showPage(1);

// $("#pagin li a").click(function() {
//     $("#pagin li a").removeClass("current");
//     $(this).addClass("current");
//     showPage(parseInt($(this).text())) 
// });

    // $(document).ready(function() {
    //             $('#myTable').paging({limit:7});
    //         });
//     $("li").click(function () {
//   $(this).addClass("active").siblings().removeClass("active");
// });

// $('td','table').each(function(i){table
//   $(this).text(i+1)
//   console.log('working',$(this).text(i+1))
// })


function getPageList(totalPages, page, maxLength) {
    if (maxLength < 5) throw "maxLength must be at least 5";

    function range(start, end) {
        return Array.from(Array(end - start + 1), (_, i) => i + start); 
    }

    var sideWidth = maxLength < 9 ? 1 : 2;
    var leftWidth = (maxLength - sideWidth*2 - 3) >> 1;
    var rightWidth = (maxLength - sideWidth*2 - 2) >> 1;
    if (totalPages <= maxLength) {
        // no breaks in list
        return range(1, totalPages);
    }
    if (page <= maxLength - sideWidth - 1 - rightWidth) {
        // no break on left of page
        return range(1, maxLength - sideWidth - 1)
            .concat(0, range(totalPages - sideWidth + 1, totalPages));
    }
    if (page >= totalPages - sideWidth - 1 - rightWidth) {
        // no break on right of page
        return range(1, sideWidth)
            .concat(0, range(totalPages - sideWidth - 1 - rightWidth - leftWidth, totalPages));
    }
    // Breaks on both sides
    return range(1, sideWidth)
        .concat(0, range(page - leftWidth, page + rightWidth),
                0, range(totalPages - sideWidth + 1, totalPages));
}

// Below is an example use of the above function.
$(function () {
    // Number of items and limits the number of items per page
    var numberOfItems = $("tbody tr").length;
    var limitPerPage = 10;
    // Total pages rounded upwards
    var totalPages = Math.ceil(numberOfItems / limitPerPage);
    // Number of buttons at the top, not counting prev/next,
    // but including the dotted buttons.
    // Must be at least 5:
    var paginationSize = 5; 
    var currentPage;

    function showPage(whichPage) {
        if (whichPage < 1 || whichPage > totalPages) return false;
        currentPage = whichPage;
        $("tbody tr").hide()
            .slice((currentPage-1) * limitPerPage, 
                    currentPage * limitPerPage).show();
        // Replace the navigation items (not prev/next):            
        $(".pager li").slice(1, -1).remove();
        getPageList(totalPages, currentPage, paginationSize).forEach( item => {
            $("<li>").addClass("page-item")
                     .addClass(item ? "current-page" : "disabled")
                     .toggleClass("active", item === currentPage).append(
                $("<a>").addClass("page-link1").attr({
                    href: "javascript:void(0)"}).text(item || "...")
            ).insertBefore("#next-page");
        });
        // Disable prev/next when at first/last page:
        $("#previous-page").toggleClass("disabled", currentPage === 1);
        $("#next-page").toggleClass("disabled", currentPage === totalPages);
        return true;
    }

    // Include the prev/next buttons:
    $(".pager").append(
        $("<li>").addClass("page-item").attr({ id: "previous-page" }).append(
            $("<a>").addClass("page-link1").attr({
                href: "javascript:void(0)"}).text("Prev")
        ),
        $("<li>").addClass("page-item").attr({ id: "next-page" }).append(
            $("<a>").addClass("page-link1").attr({
                href: "javascript:void(0)"}).text("Next")
        )
    );
    // Show the page links
    $("tbody tr").show();
    showPage(1);

    // Use event delegation, as these items are recreated later    
    $(document).on("click", ".pager li.current-page:not(.active)", function () {
        return showPage(+$(this).text());
    });
    $("#next-page").on("click", function () {
        return showPage(currentPage+1);
    });

    $("#previous-page").on("click", function () {
        return showPage(currentPage-1);
    });
});




// $('table.paginated').each(function(){
//   var currentPage = 0;
//     var numPerPage = 1 ;
//     var $table = $(this);
//     console.log($table)
//     $table.bind('repaginate', function() {
//         $table.find('tbody tr').hide().slice(currentPage * numPerPage, (currentPage + 1) * numPerPage).show();
    
// });
//     $table.trigger('repaginate');
//     var numRows = $table.find('tbody tr').length;
//     console.log('numRows',numRows)
//     console.log(numRows)
//     var numPages = Math.ceil(numRows / numPerPage);
//     console.log(numPages)
//     var $pager = $('.pager');
//     var $previous = $('<span class="previous">Prev</spnan>');
//     var $next = $('<span class="next "><b>Next</b></spnan>')
//     for (var page = 0; page < numPages; page++) {
//       $('<span class="page-number"></span>').text(page + 1).bind('click', {
//           newPage: page
//       }, function(event) {
//           currentPage = event.data['newPage'];
//           console.log(currentPage)
//           $table.trigger('repaginate');
//           $(this).addClass('active').siblings().removeClass('active');
//       }).appendTo($pager).addClass('clickable');
//     }
//     // $pager.insertBefore($table).find('span.page-number:first').addClass('active');
//     $pager.find('span.page-number:first').addClass('active')
//     $previous.insertBefore('span.page-number:first');
//     $next.insertAfter('span.page-number:last');
//     $next.click(function (e) {
//         $previous.addClass('clickable');
//         $pager.find('.active').next('.page-number.clickable').click();
//     });
//     $previous.click(function (e) {
//         $next.addClass('clickable');
//         $pager.find('.active').prev('.page-number.clickable').click();
//     });
//     $table.on('repaginate', function () {
//         $next.addClass('clickable');
//         $previous.addClass('clickable');
        
//         setTimeout(function () {
//             var $active = $pager.find('.page-number.active');
//             if ($active.next('.page-number.clickable').length === 0) {
//                 $next.removeClass('clickable');
//             } else if ($active.prev('.page-number.clickable').length === 0) {
//                 $previous.removeClass('clickable');
//             }
//         });
//     });
//     var paginationSize = 2;
//     getPageList(numPages, currentPage, paginationSize)
//     var list = document.getElementsByClassName("page-number");
//       for(var i = 2; i < list.length; i++){
//         console.log(i)
//       list[i].style.display = 'none';
//     }

//     $table.trigger('repaginate');
// });

// var numPerPage = 10 ;
// var numRows = $table.find('tbody tr').length;
// var numPages = Math.ceil(numRows / numPerPage);

// $('.pager').twbsPagination({
//   totalPages: numPages,
//   visiblePages: 1,
//   onPageClick: function(event, page) {
//     var startIndex = (pageSize * (page - 1))
//     var endIndex = startIndex + pageSize
//     $('tbody tr').hide().filter(function() {
//       var idx = $(this).index();
//       return idx >= startIndex && idx < endIndex;
//     }).show()
//   }
// });

      $('.user-email').click(function(){
        // alert('working')
        var name = $(this).closest("tr").find('td:eq(0)').text();
        var emp_code = $(this).closest("tr").find('td:eq(7)').text();
        $.ajax({
                  type : 'POST',
                  url :  "{% url 'send_email' %}",
                  data : {'name':name,'emp_code':emp_code},
                  success : function(response){
                  //reset the form after successful submit
                    alert(response) 
                  },
                  error : function(response){
                      console.log(response)
                  }
              });

      
      })
      $('#submit').click(function(){
        $('#filter_form').submit()
      
      })

      $('#department1').click(function(){
        // 
//         var input, filter , table , tr , td , i, txtvalue;
//         input =  $('#department1').val();
//         alert(input)
//         filter = input.toUpperCase();
//         var branch = $('#branch').val().toUpperCase();
//         var status = $('#status').val().toUpperCase();
//         var gender = $('#gender').val().toUpperCase();
//         // alert(branch)
//         table = document.getElementById("myTable");
//         tr = table.getElementsByTagName("tr");
//         // alert(tr.length)
//         // alert(filter)
//         for(i = 0 ; i< tr.length; i++){
//           // var rowText = tr[i].textContent;
//           // console.log('row text',rowText)
//           td = tr[i].getElementsByTagName("td")[3];
//          var  td2 = tr[i].getElementsByTagName("td")[2]
//         var   tdstatus = tr[i].getElementsByTagName("td")[4]
//         var  tdgender = tr[i].getElementsByTagName("td")[8]
//           if(td){
//             console.log('dept',filter,'branch',branch,'status',status,'gender',gender)
//             // alert('working')
//             txtvalue = td.textContent || td.innerText;
//            var  txtvalue2 = td2.textContent || td2.innerText;
//            var  txtvalue3 = tdstatus.textContent || tdstatus.innerText;
//            var  txtvalue4 = tdgender.textContent || tdgender.innerText;

            
//             if(branch == "BRANCH" && status == 'STATUS' && gender == 'GENDER' && filter != 'DEPARTMENT'){
//                   if(txtvalue.toUpperCase().indexOf(filter) > -1){
//                   tr[i].style.display = '';
//                   var numRows = tr.length;
//                   var x = document.getElementById("myTable");
//                   console.log('numRows',numRows)
//                       console.log('######################',tr[i].length)


//                 }else{  
//                   tr[i].style.display = 'none';
//                 }
//             }
//             else if(filter == 'DEPARTMENT' && branch != "BRANCH" ){
//               // alert('working')
//               if(txtvalue2.toUpperCase() == branch){
//                   // console.log('working')
//                 tr[i].style.display = '';
//                   }else{
//                     tr[i].style.display = 'none';
//                   }
//             }
//             else if(filter == 'DEPARTMENT' && status != "STATUS" ){
//               if(txtvalue3.toUpperCase() == status){
//                   // console.log('working')
//                 tr[i].style.display = '';
//                   }else{
//                     tr[i].style.display = 'none';
//                   }

//             }
//             else if (filter == 'DEPARTMENT' && gender != "GENDER" ){
//               if(txtvalue4.toUpperCase() == gender){
//                   // console.log('working')
//                 tr[i].style.display = '';
//                   }else{
//                     tr[i].style.display = 'none';
//                   }
//             }
//             else if(branch != "BRANCH" && status == 'STATUS' && gender == 'GENDER'){
//                 if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch){
//                   // console.log('working')
//                 tr[i].style.display = '';
//                   }else{
//                     tr[i].style.display = 'none';
//                   }
//             }else if(branch == "BRANCH" && status != 'STATUS' && gender == 'GENDER'){
//                 if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }
//             }else if(branch == "BRANCH" && status == 'STATUS' && gender != 'GENDER'){
//               if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }

//             }else if(branch != "BRANCH" && status != 'STATUS' && gender == 'GENDER'){
//               if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch && txtvalue3.toUpperCase() == status){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }
//             }else if(branch != "BRANCH" && status == 'STATUS' && gender != 'GENDER'){
//               if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == branch && txtvalue4.toUpperCase() == gender){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }
//             }else if(branch == "BRANCH" && status != 'STATUS' && gender != 'GENDER'){
//               if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }
//             }else if(branch != "BRANCH" && status != 'STATUS' && gender != 'GENDER'){
//               if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == branch){
//                     console.log('working')
//                   tr[i].style.display = '';
//                     }else{
//                       tr[i].style.display = 'none';
//                     }
//             }
            
//             else{
//               console.log('Working')
//               tr[i].style.display = '';
//               // tr[i].style.display = 'none';
//               // alert('working')
//             }

//             // if(filter == 'DEPARTMENT' && branch != "BRANCH"){
//             //   alert('working')
//             // }
//           }
          
     
//           // console.log('################',$("tbody > tr:visible"))
//         }
//         function getDisplayedRows($targetTable) {
//             return $targetTable.find('tbody tr:not([style*="display: none"])');
//     }

//     $(function() { //shortcut for document ready
//         var $table = $("#myTable"), //get table by selector
//             $visibleRows = getDisplayedRows($table);
//             //run function to get rows without display: none
//             console.log($visibleRows.text())

//     });
//           $("tbody td:not([style*='display: block'])").each(function(){
        
//         console.log('data @@@@@@',$(this).text());
//       });
// // $('tbody tr','table').each(function(){table
  
// //   var $table = $("#myTable"), //get table by selector
// //   $visibleRows = getDisplayedRows($table);
// //   console.log($visibleRows.length)
// //   // console.log('working',$(this).text(i+1))
// //   $(this).text($visibleRows.text());
// //   // $(this).text(i+1)
// // })
//     console.log('@@@@@@@###$$$$$$$$$$$$%%%%%%%%%%%%%%',$('tbody tr:not([style*="display: none"])').length)
// //         $('table.paginated').each(function() {
// //   var currentPage = 0;
// //   var numPerPage = 12;
// //   var $table = $(this);
// //   var $pager = $('<div class="pager1"></div>');
// //   var $previous = $('<span class="previous1"><<</spnan>');
// //   var $next = $('<span class="next1">>></spnan>');

// //   $pager.find('span.page-number1:first').addClass('active');

// //   $table.bind('repaginate', function() {
// //     $table.find('tbody tr').hide();

// //     // $filteredRows = $table.find('tbody tr').filter(function(i, tr) {
// //       // alert('working')  
// //       // var $table = $("#myTable"), //get table by selector
// //             // $visibleRows = getDisplayedRows($table);
// //             //run function to get rows without display: none
// //             console.log($visibleRows.text())
// //       return $visibleRows;
// //       // return $('#department1').val() != "" ? $(tr).find("td").get().map(function(td) {
// //         // return $(td).text();
// //         // alert($(td).text())
// //       // }).filter(function(td){
// //       	// return td.indexOf($('#department1').val()) != -1; 
// //       // }).length > 0 : true;
// //     });

// //     $filteredRows.slice(currentPage * numPerPage, (currentPage + 1) * numPerPage).show();

// //     var numRows = $filteredRows.length;
// //     var numPages = Math.ceil(numRows / numPerPage);
		
// //     $pager.find('.page-number1, .previous1, .next1').remove();
// //     for (var page = 0; page < numPages; page++) {
// //       var $newPage = $('<span class="page-number1"></span>').text(page + 1).bind('click', {
// //         newPage: page
// //       }, function(event) {
// //         currentPage = event.data['newPage'];
// //         $table.trigger('repaginate');
// //       })
// //       if(page == currentPage){
// //       	$newPage.addClass('clickable active');
// //      	}else{
// //       	$newPage.addClass('clickable');
// //       }
// //       $newPage.appendTo($pager)
// //     }
    
// //     $previous.insertBefore('span.page-number1:first');
// //   	$next.insertAfter('span.page-number1:last');

// //     $next.click(function(e) {
// //       $previous.addClass('clickable');
// //       $pager.find('.active').next('.page-number1.clickable').click();
// //     });
// //     $previous.click(function(e) {
// //       $next.addClass('clickable');
// //       $pager.find('.active').prev('.page-number1.clickable').click();
// //     });

// //     $next.addClass('clickable');
// //     $previous.addClass('clickable');

// //     setTimeout(function() {
// //       var $active = $pager.find('.page-number1.active');
// //       if ($active.next('.page-number1.clickable').length === 0) {
// //         $next.removeClass('clickable');
// //       } else if ($active.prev('.page-number1.clickable').length === 0) {
// //         $previous.removeClass('clickable');
// //       }
// //     });
// //   });
// //   $table.trigger('repaginate');
// // });
        
//         // alert($('tr:not([style*="display: none"])').length)
//         $('.pager').hide();
//         $('.previous').hide();
//         $('.next').hide();
        
        
      })



      // $('#branch').click(function(){
        
      //   var input , filter, table, tr, td,i,txtvalue;
      //   input = $('#branch').val();
      //   // alert(input)
      //   filter = input.toUpperCase();
      //   var department = $('#department1').val().toUpperCase();
      //   var status = $('#status').val().toUpperCase();
      //   var gender = $('#gender').val().toUpperCase();
      //   table = document.getElementById("myTable");
      //   tr = table.getElementsByTagName("tr");
        
      //   for(i = 0 ; i< tr.length; i++){
      //     td = tr[i].getElementsByTagName("td")[2];
      //     var td2 = tr[i].getElementsByTagName("td")[3]
      //     var tdstatus = tr[i].getElementsByTagName("td")[4]
      //     var tdgender = tr[i].getElementsByTagName("td")[8]
      //     if(td){
      //       txtvalue = td.textContent || td.innerText;
      //       var txtvalue2 = td2.textContent || td2.innerText;
      //       var txtvalue3 = tdstatus.textContent || tdstatus.innerText;
      //       var txtvalue4 = tdgender.textContent || tdgender.innerText;

      //       if(filter != "BRANCH" && status == 'STATUS' && gender == 'GENDER' && department == 'DEPARTMENT'){
      //         $('#filter_form').submit()  
      //       }
      //       else if(filter == 'BRANCH' && department != "DEPARTMENT" ){
      //         // alert('working')
      //         if(txtvalue2.toUpperCase() == department){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(filter == 'BRANCH' && status != "STATUS" ){
      //         if(txtvalue3.toUpperCase() == status){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }

      //       }
      //       else if (filter == 'BRANCH' && gender != "GENDER" ){
      //         if(txtvalue4.toUpperCase() == gender){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(department != 'DEPARTMENT' && status == 'STATUS' && gender == 'GENDER'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
      //             console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }else if(department == 'DEPARTMENT' && status != 'STATUS' && gender == 'GENDER'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && status == 'STATUS' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }

      //       }else if(department != 'DEPARTMENT' && status != 'STATUS' && gender == 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == status){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && status == 'STATUS' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && status != 'STATUS' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && status != 'STATUS' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == status && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == department){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }
      //       else{
      //         // console.log('Working')
      //         tr[i].style.display = '';
      //       }

      //     }
      //   }
      //   // $('.pager').hide();
      //   // $('.previous').hide();
      //   // $('.next').hide();

      // })

      // $('#status').click(function(){
      //   var input, filter , table , tr , td,i,txtvalue;
      //   input = $('#status').val();
      //   filter = input.toUpperCase();
      //   // alert(filter)
      //   var department = $('#department1').val().toUpperCase();
      //   var gender = $('#gender').val().toUpperCase();
      //   var branch = $('#branch').val().toUpperCase();
      //   table = document.getElementById("myTable");
      //   tr = table.getElementsByTagName("tr");
      //   // alert(tr.length)
      //   // alert(filter)
      //   for(i = 0 ; i< tr.length; i++){
      //     td = tr[i].getElementsByTagName("td")[4];
      //     var td2 = tr[i].getElementsByTagName("td")[3]
      //     var td3 = tr[i].getElementsByTagName("td")[2];
      //     var td4 = tr[i].getElementsByTagName("td")[8]

      //     if(td){9

      //       txtvalue = td.textContent || td.innerText;
      //       var txtvalue2 = td2.textContent || td2.innerText;
      //       var txtvalue3 = td3.textContent || td3.innerText;
      //       var txtvalue4 = td4.textContent || td4.innerText;
      //       // alert(txtvalue.toUpperCase())
      //       // alert(filter)
      //       // alert(txtvalue)
      //       // if(txtvalue.toUpperCase() == filter ){
      //       //   tr[i].style.display = '';
      //       //   console.log(txtvalue)
      //       //   console.log(tr[i].innerText)
      //       // }else{BRANCH
      //       //   tr[i].style.display = 'none';
      //       // }
      //       if(filter != "STATUS" && branch == 'BRANCH' && gender == 'GENDER' && department == 'DEPARTMENT'){
      //             if(txtvalue.toUpperCase().indexOf(filter) > -1){
      //             tr[i].style.display = '';
      //           }else{
      //             tr[i].style.display = 'none';
      //           }
      //       }
      //       else if(filter == 'STATUS' && department != "DEPARTMENT" ){
      //         // alert('working')
      //         if(txtvalue2.toUpperCase() == department){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(filter == 'STATUS' && branch != "BRANCH" ){
      //         if(txtvalue3.toUpperCase() == branch){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }

      //       }
      //       else if (filter == 'STATUS' && gender != "GENDER" ){
      //         if(txtvalue4.toUpperCase() = gender ){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(department != 'DEPARTMENT' && branch == 'BRANCH' && gender == 'GENDER'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
      //             console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }else if(department == 'DEPARTMENT' && branch != 'BRANCH'  && gender == 'GENDER'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && branch == 'BRANCH' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }

      //       }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && gender == 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == branch){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && branch == 'BRANCH' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && branch != 'BRANCH' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == gender){
      //               console.log('working')
      //             tr[i].style.display = '';
      //              }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && gender != 'GENDER'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == gender && txtvalue2.toUpperCase() == department){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }
      //       else{
      //         // console.log('Working')
      //         tr[i].style.display = '';

      //       }


      //     }
      //   }
      //   $('.pager').hide();
      //   $('.previous').hide();
      //   $('.next').hide();
      
      // })

      // $('#gender').click(function(){
      //   var input, filter , table , tr , td,i,txtvalue;
      //   input = $('#gender').val();
      //   filter = input.toUpperCase();
      //   table = document.getElementById("myTable");
      //   tr = table.getElementsByTagName("tr");
      //   var department = $('#department1').val().toUpperCase();
      //   var status = $('#status').val().toUpperCase();
      //   var branch = $('#branch').val().toUpperCase();
      //   // alert(tr)
      //   // alert(tr.length)
      //   // alert(filter)
      //  for(i = 0 ; i< tr.length; i++){
      //   // console.log(tr[i])
      //     td = tr[i].getElementsByTagName("td")[8];
      //     var td4 = tr[i].getElementsByTagName("td")[4];
      //     var td2 = tr[i].getElementsByTagName("td")[3]
      //     var td3 = tr[i].getElementsByTagName("td")[2];
      //     if(td){
      //       txtvalue = td.textContent || td.innerText;
      //       var txtvalue2 = td2.textContent || td2.innerText;
      //       var txtvalue3 = td3.textContent || td3.innerText;
      //       var txtvalue4 = td4.textContent || td4.innerText;
      //       // alert(txtvalue.toUpperCase())
      //       // alert(filter)
      //       // alert(txtvalue)
      //       // if(txtvalue.toUpperCase() == filter ){
      //       //   tr[i].style.display = '';
      //       //   console.log(txtvalue)
      //       //   console.log(tr[i].innerText)
      //       // }else{
      //       //   tr[i].style.display = 'none';GENDER
      //       // }
      //       if(filter != "GENDER" && branch == 'BRANCH' && status == 'STATUS' && department == 'DEPARTMENT'){
      //             if(txtvalue.toUpperCase().indexOf(filter) > -1){
      //             tr[i].style.display = '';
      //           }else{
      //             tr[i].style.display = 'none';
      //           }
      //       }
      //       else if(filter == 'GENDER' && department != "DEPARTMENT" ){
      //         // alert('working')
      //         if(txtvalue2.toUpperCase() == department){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(filter == 'GENDER' && branch != "BRANCH" ){
      //         if(txtvalue3.toUpperCase() == branch){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }

      //       }
      //       else if (filter == 'GENDER' && status != "STATUS" ){
      //         if(txtvalue4.toUpperCase() == status){
      //             // console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }
      //       else if(department != 'DEPARTMENT' && branch == 'BRANCH' && status == 'STATUS'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department){
      //             console.log('working')
      //           tr[i].style.display = '';
      //             }else{
      //               tr[i].style.display = 'none';
      //             }
      //       }else if(department == 'DEPARTMENT' && branch != 'BRANCH'  && status == 'STATUS'){
      //           if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && branch == 'BRANCH' && status != 'STATUS'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue4.toUpperCase() == status){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }

      //       }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && status == 'STATUS'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue3.toUpperCase() == branch){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && branch == 'BRANCH' && status != 'STATUS'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue2.toUpperCase() == department && txtvalue4.toUpperCase() == status){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department == 'DEPARTMENT' && branch != 'BRANCH' && status != 'STATUS'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == status){
      //               console.log('working')
      //             tr[i].style.display = '';
      //              }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }else if(department != 'DEPARTMENT' && branch != 'BRANCH' && status != 'STATUS'){
      //         if(txtvalue.toUpperCase() == filter && txtvalue3.toUpperCase() == branch && txtvalue4.toUpperCase() == status && txtvalue2.toUpperCase() == department){
      //               console.log('working')
      //             tr[i].style.display = '';
      //               }else{
      //                 tr[i].style.display = 'none';
      //               }
      //       }
      //       else{
      //         console.log('Working')
      //         tr[i].style.display = '';
      //       }
      //     }
      //   }
      //   $('.pager').hide();
      //   $('.previous').hide();
      //   $('.next').hide();
      
      // })
      function export2csv() {
        let data = "";
        const tableData = [];
        const rows = document.querySelectorAll("table tr");
        for (const row of rows) {
          const rowData = [];
          for (const [index, column] of row.querySelectorAll("th, td").entries()) {
            // To retain the commas in the "Description" column, we can enclose those fields in quotation marks.
            if ((index + 1) % 3 === 0) {
              rowData.push('"' + column.innerText + '"');
            } else {
              rowData.push(column.innerText);
            }
          }
          tableData.push(rowData.join(","));
        }
        data += tableData.join("\n");
        const a = document.createElement("a");
        a.href = URL.createObjectURL(new Blob([data], { type: "text/csv" }));
        a.setAttribute("download", "data.csv");
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      }

      function parseDate(str) {
      var mdy = str.split('-');
      // alert(mdy)
      // alert(new Date(mdy[2], mdy[0]-1, mdy[1]))
      return new Date(mdy[2], mdy[0]-1, mdy[1]);  
      }

      function datediff(first, second) {
          // Take the difference between the dates and divide by milliseconds per day.
          // Round to nearest whole number to deal with DST.
          return Math.round((second-first)/(1000*60*60*24));
      }
      

      $('#export').click(function(){
        var arrData=[];
   // loop over each table row (tr)
          $("#myTable tr").each(function(){
                var currentRow=$(this);
                if(currentRow.is(':hidden') && screen.width >= 500){
                 console.log('working is hidden')
                }
                else if (screen.width <= 500 && currentRow.is(':hidden')){
                    // alert('working')
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();
                    
                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  // console.log(Difference_In_Time / (1000 * 60 * 60 * 24))
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  // alert(row.length)
                  // ['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'],
                  arrData.push(row.join(","))
                  // console.log('rows',row)
                  // alert(arrData.length)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  // alert(arrData)
                  }
                else{
                    // console.log(currentRow.length)
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();

                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  // console.log(Difference_In_Time / (1000 * 60 * 60 * 24))
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  // alert(row.length)
                  // ['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'],
                  arrData.push(row.join(","))
                  // console.log('rows',row)
                  // alert(arrData.length)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  // alert(arrData)
                  // console.log('array data',arrData);
                  // );
                  // 
                }   
                // 
          });   
          // alert(arrData.length) 
          len = arrData.length;
          // console.log(len)
          var data = []
          data.push(['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'])
          for(var i =1 ; i<=len;i++){
            // console.log(i)
            // console.log(arrData[i])
            data.push(arrData[i])
          }
          // console.log(data)
          downloadCSVFile(data.join("\n"), "status.csv")
          // htmlToCSV(arrData, "status.csv");
        })



      function htmlToCSV(html, filename) {
        var data = [];
        var rows = document.querySelectorAll("table tr");
        console.log(rows.length)
        for (var i = 0; i < rows.length; i++) {
          var row = [], cols = rows[i].querySelectorAll("td, th");            
          for (var j = 0; j < cols.length; j++) {
                  row.push(cols[j].innerText);
                      }
          // console.log(row.join(","))
          data.push(row.join(",")); 
          // console.log('NEXT LINE',data.join("\n"))		
        }
        

        // downloadCSVFile(data.join("\n"), );
      }

      function downloadCSVFile(csv, filename) {
        var csv_file, download_link;

        csv_file = new Blob([csv], {type: "text/csv"});

        download_link = document.createElement("a");

        download_link.download = filename;

        download_link.href = window.URL.createObjectURL(csv_file);

        download_link.style.display = "none";

        document.body.appendChild(download_link);

        download_link.click();
      }

      $('#exportemail').click(function(){
        var arrData=[];
        $("#myTable tr").each(function(){
                var currentRow=$(this);
                if(currentRow.is(':hidden') && screen.width >= 500){
                 console.log('working')
                }else if (screen.width <= 500 && currentRow.is(':hidden')){
                    // alert('working')
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();
                    
                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  // console.log(Difference_In_Time / (1000 * 60 * 60 * 24))
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  // alert(row.length)
                  // ['Name','Last Checked','Branch','Department','Status','Emp Code','Gender','Birth Year','Beneficiary Id','vaccine','Dose1 Date','Does2 Date','Difference between Dose 1 to today(in Days)','Difference between Dose 2 to today(in Days)'],
                  arrData.push(row.join(","))
                  // console.log('rows',row)
                  // alert(arrData.length)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  // alert(arrData)
                  }
                else{
                    // console.log(currentRow.length)
                    var col1_value=currentRow.find("td:eq(0)").text();
                  var col2_value=currentRow.find("td:eq(1)").text();
                  var col3_value=currentRow.find("td:eq(2)").text();
                  var col4_value=currentRow.find("td:eq(3)").text();
                  var col5_value=currentRow.find("td:eq(4)").text();
                  var col6_value=currentRow.find("td:eq(7)").text();
                  // var col7_value=currentRow.find("td:eq(6)").text();
                  var col8_value=currentRow.find("td:eq(8)").text();
                  var col9_value=currentRow.find("td:eq(9)").text();
                  var col10_value=currentRow.find("td:eq(10)").text();
                  var col11_value=currentRow.find("td:eq(11)").text();
                  var col12_value=currentRow.find("td:eq(12)").text();
                  var col13_value=currentRow.find("td:eq(13)").text();


                  var datearray = col12_value.split("-");
                  var newdate = datearray[1] + '/' + datearray[0] + '/' + datearray[2];
                  var date1 = new Date(newdate)



                  var currentDate = new Date()
                  var Difference_In_Time = currentDate.getTime() - date1.getTime();
                  var Difference_In_Days =parseInt(Difference_In_Time / (1000 * 60 * 60 * 24));
                  
                  Difference_In_Days2 =''
                  if(col9_value != ''){
                    var datearray1 = col13_value.split("-");
                    var newdate1 = datearray1[1] + '/' + datearray1[0] + '/' + datearray1[2];
                    var date3 = new Date(newdate1)
                    var Difference_In_Time1 = currentDate.getTime() - date3.getTime()
                    var Difference_In_Days2 = parseInt(Difference_In_Time1 / (1000 * 60 * 60 * 24));
                  
                    
                  }
                  var row = []
                  row.push(col1_value,col2_value,col3_value,col4_value,col5_value,col6_value,col8_value,col9_value,col10_value,col11_value,col12_value,col13_value,Difference_In_Days, Difference_In_Days2)
                  arrData.push(row.join(","))
                  // console.log('rows',row)
                  var obj={};
                  obj.col1=col1_value;
                  obj.col2=col2_value;
                  obj.col3=col3_value;
                  obj.col4=col4_value;
                  obj.col5=col5_value;
                  // console.log('array data',arrData);
                  // htmlToCSV(arrData, "status.csv");
                }    
          }); 
          $.ajax({
            type : 'POST',
            url :  "{% url 'exportfile' %}",
            data : {'data':arrData},
            success : function(response){
            //reset the form after successful submit
              alert(response) 
            },
            error : function(response){
                console.log(response)
            }
        });

      })

        $('#upload').change(function(){
            $('#upload_csv').submit();
            })
       


            var config = {
              type: 'doughnut',
              plugins: [{
              afterDraw: chart => {
                var ctx = chart.chart.ctx;
                ctx.save();
                var image = new Image();      
                image.src = "{% static 'img/vaccine.png' %}";      
                imageSize = 140;
                ctx.drawImage(image, chart.chart.width / 2 - imageSize / 2, chart.chart.height / 2 - imageSize / 2, imageSize, imageSize);
                ctx.restore();
              }
            }],
                data: {
                // labels:['Fully Vaccinated','Partial vaccinated','Not Vaccinated','Not Checked']
                  datasets: [{
                    data: [{{fully_vaccinated}}, {{partial_vaccinated}}, {{not_vaccinated}},{{not_checked}}],
                    backgroundColor: [
                  	'#20e074','#ffb800','#7d3ac1','#fd3636'
                    ],
                  borderWidth: [0, 0, 0, 0],
          //           label: 'Population'
                  }],
                  labels: ['Fully Vaccinated','Partial vaccinated','Not Vaccinated','Not Checked']
                },
                options: {
                  cutoutPercentage: 85,
                  responsive: true,
                  legend: {
                    display: false
                },
                tooltips: {
                    enabled: true,
                }

                }
              };
           
              window.onload = function() {
                var ctx = document.getElementById('pie-chart').getContext('2d');
                window.myPie = new Chart(ctx, config);
              };
          $('.use-address').click(function () {
            // alert('working')
            var name = $(this).closest("tr").find('td:eq(0)').text();
            var emp_code = $(this).closest("tr").find('td:eq(7)').text();              
            // alert(id);
              $.ajax({
                  type : 'POST',
                  url :  "{% url 'download_certificate' %}",
                  data : {'name':name,'emp_code':emp_code},
                  success : function(response){
                  //reset the form after successful submit
                    // alert(response)
                    if(response != 'Certificate not available at present. Please send email to follow-up'){
                      var url = response
                    // window.location = url; 
                    window.open(url, '_blank').focus();
                    }else{
                      alert(response)
                    }
                    
                  },
                  error : function(response){
                      console.log(response)
                  }
              });
          });
    </script> 
{% endblock content_js %}
